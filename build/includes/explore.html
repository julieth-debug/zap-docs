<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>API Documentation</title>

    <link rel="icon" href="favicon.ico" />

    <link href="../stylesheets/screen.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="../stylesheets/print.css" rel="stylesheet" type="text/css" media="print" />
    <link href="../stylesheets/navio.css" rel="stylesheet" type="text/css" media="all" />

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
      <script src="../javascripts/all_nosearch.js" type="text/javascript"></script>

  </head>

  <body class="includes includes_explore">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="../images/navbar.png" alt="Navbar" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <img src="../images/logo.png" alt="Logo" />
      <div id="toc">
      </div>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="exploring-the-app"><a name="examples"></a>Exploring The App</h1>

<p>Its recommended to explore the web application before performing any scan or attack. The more you explore your App the more 
accurate the results will be. If the application is not explored very well then it will impact or reduce the vulnerabilities ZAP can find.
The following are some of the options to explore the site by using ZAP.</p>

<ul>
<li><p><strong>Traditional Spider (Crawler)</strong></p></li>
<li><p><strong>Ajax Spider</strong> </p></li>
<li><p><strong>Proxy Regression / Unit tests:</strong> This is the recommended approach, if you already have a test suite or unit tests.</p></li>
<li><p><strong>Spider SOAP Definition</strong></p></li>
</ul>

<h2 id="using-spider">Using Spider</h2>
<pre class="highlight shell"><code><span class="c"># Start the spider scan </span>
<span class="gp">$ </span>curl <span class="s2">"http://localhost:8080/JSON/spider/action/scan/?apikey=zapAPIKey&amp;zapapiformat=JSON&amp;url=https://public-firing-range.appspot.com&amp;contextName=&amp;recurse=true"</span>


<span class="c"># To view the scan status</span>
<span class="gp">$ </span>curl <span class="s2">"http://localhost:8080/JSON/spider/view/status/?apikey=zapAPIKey&amp;scanId=&lt;scan id&gt;"</span>


<span class="c"># To view the scan results</span>
<span class="gp">$ </span>curl <span class="s2">"http://localhost:8080/JSON/spider/view/results/?apikey=zapAPIKey&amp;scanId=0"</span>


<span class="c"># To stop the scanning</span>
<span class="gp">$ </span>curl <span class="s2">"http://localhost:8080/JSON/spider/action/stop/?scanId=&lt;scan_id&gt;"</span>
<span class="c"># To pause the scanning</span>
<span class="gp">$ </span>curl <span class="s2">"http://localhost:8080/JSON/spider/action/pause/?scanId=&lt;scan_id&gt;"</span>
<span class="c"># To resume the scanning</span>
<span class="gp">$ </span>curl <span class="s2">"http://localhost:8080/JSON/spider/action/resume/?scanId=&lt;scan_id&gt;"</span>

</code></pre>
<pre class="highlight java"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Spider</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">ZAP_ADDRESS</span> <span class="o">=</span> <span class="s">"localhost"</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">ZAP_PORT</span> <span class="o">=</span> <span class="mi">8080</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">ZAP_API_KEY</span> <span class="o">=</span>
    <span class="kc">null</span><span class="o">;</span> <span class="c1">// Change this if you have set the apikey in ZAP via Options / API</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">TARGET</span> <span class="o">=</span> <span class="s">"https://public-firing-range.appspot.com"</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="n">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">ClientApi</span> <span class="n">api</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ClientApi</span><span class="o">(</span><span class="n">ZAP_ADDRESS</span><span class="o">,</span> <span class="n">ZAP_PORT</span><span class="o">,</span> <span class="n">ZAP_API_KEY</span><span class="o">);</span>

        <span class="k">try</span> <span class="o">{</span>
            <span class="c1">// Start spidering the target</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Spider : "</span> <span class="o">+</span> <span class="n">TARGET</span><span class="o">);</span>
            <span class="c1">// Create the</span>
            <span class="n">ApiResponse</span> <span class="n">resp</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="na">spider</span><span class="o">.</span><span class="na">scan</span><span class="o">(</span><span class="n">TARGET</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
            <span class="n">String</span> <span class="n">scanid</span><span class="o">;</span>
            <span class="kt">int</span> <span class="n">progress</span><span class="o">;</span>

            <span class="c1">// The scan now returns a scan id to support concurrent scanning</span>
            <span class="n">scanid</span> <span class="o">=</span> <span class="o">((</span><span class="n">ApiResponseElement</span><span class="o">)</span> <span class="n">resp</span><span class="o">).</span><span class="na">getValue</span><span class="o">();</span>

            <span class="c1">// Poll the status until it completes</span>
            <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">1000</span><span class="o">);</span>
                <span class="n">progress</span> <span class="o">=</span>
                        <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span>
                                <span class="o">((</span><span class="n">ApiResponseElement</span><span class="o">)</span> <span class="n">api</span><span class="o">.</span><span class="na">spider</span><span class="o">.</span><span class="na">status</span><span class="o">(</span><span class="n">scanid</span><span class="o">)).</span><span class="na">getValue</span><span class="o">());</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Spider progress : "</span> <span class="o">+</span> <span class="n">progress</span> <span class="o">+</span> <span class="s">"%"</span><span class="o">);</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">progress</span> <span class="o">&gt;=</span> <span class="mi">100</span><span class="o">)</span> <span class="o">{</span>
                    <span class="k">break</span><span class="o">;</span>
                <span class="o">}</span>
            <span class="o">}</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Spider complete"</span><span class="o">);</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">api</span><span class="o">.</span><span class="na">spider</span><span class="o">.</span><span class="na">results</span><span class="o">(</span><span class="n">scanid</span><span class="o">));</span>

        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Exception : "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
<pre class="highlight python"><code><span class="c">#!/usr/bin/env python</span>
<span class="c"># A basic ZAP Python API example which spiders and scans a target URL</span>

<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="kn">from</span> <span class="nn">zapv2</span> <span class="kn">import</span> <span class="n">ZAPv2</span>

<span class="n">target</span> <span class="o">=</span> <span class="s">'http://127.0.0.1'</span>
<span class="n">apikey</span> <span class="o">=</span> <span class="s">'changeme'</span> <span class="c"># Change to match the API key set in ZAP, or use None if the API key is disabled</span>
<span class="c">#</span>
<span class="c"># By default ZAP API client will connect to port 8080</span>
<span class="n">zap</span> <span class="o">=</span> <span class="n">ZAPv2</span><span class="p">(</span><span class="n">apikey</span><span class="o">=</span><span class="n">apikey</span><span class="p">)</span>
<span class="c"># Use the line below if ZAP is not listening on port 8080, for example, if listening on port 8090</span>
<span class="c"># zap = ZAPv2(apikey=apikey, proxies={'http': 'http://127.0.0.1:8090', 'https': 'http://127.0.0.1:8090'})</span>

<span class="c"># Proxy a request to the target so that ZAP has something to deal with</span>
<span class="k">print</span><span class="p">(</span><span class="s">'Accessing target {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">target</span><span class="p">))</span>
<span class="n">zap</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
<span class="c"># Give the sites tree a chance to get updated</span>
<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">'Spidering target {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">target</span><span class="p">))</span>
<span class="n">scanid</span> <span class="o">=</span> <span class="n">zap</span><span class="o">.</span><span class="n">spider</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
<span class="c"># Give the Spider a chance to start</span>
<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="k">while</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">zap</span><span class="o">.</span><span class="n">spider</span><span class="o">.</span><span class="n">status</span><span class="p">(</span><span class="n">scanid</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">):</span>
    <span class="c"># Loop until the spider has finished</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'Spider progress </span><span class="si">%</span><span class="s">: {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">zap</span><span class="o">.</span><span class="n">spider</span><span class="o">.</span><span class="n">status</span><span class="p">(</span><span class="n">scanid</span><span class="p">)))</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="k">print</span> <span class="p">(</span><span class="s">'Spider completed'</span><span class="p">)</span>

<span class="k">while</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">zap</span><span class="o">.</span><span class="n">pscan</span><span class="o">.</span><span class="n">records_to_scan</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
      <span class="k">print</span> <span class="p">(</span><span class="s">'Records to passive scan : {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">zap</span><span class="o">.</span><span class="n">pscan</span><span class="o">.</span><span class="n">records_to_scan</span><span class="p">))</span>
      <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="k">print</span> <span class="p">(</span><span class="s">'Passive Scan completed'</span><span class="p">)</span>

<span class="k">print</span> <span class="p">(</span><span class="s">'Active Scanning target {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">target</span><span class="p">))</span>
<span class="n">scanid</span> <span class="o">=</span> <span class="n">zap</span><span class="o">.</span><span class="n">ascan</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
<span class="k">while</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">zap</span><span class="o">.</span><span class="n">ascan</span><span class="o">.</span><span class="n">status</span><span class="p">(</span><span class="n">scanid</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">):</span>
    <span class="c"># Loop until the scanner has finished</span>
    <span class="k">print</span> <span class="p">(</span><span class="s">'Scan progress </span><span class="si">%</span><span class="s">: {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">zap</span><span class="o">.</span><span class="n">ascan</span><span class="o">.</span><span class="n">status</span><span class="p">(</span><span class="n">scanid</span><span class="p">)))</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="k">print</span> <span class="p">(</span><span class="s">'Active Scan completed'</span><span class="p">)</span>

<span class="c"># Report the results</span>

<span class="k">print</span> <span class="p">(</span><span class="s">'Hosts: {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s">', '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">zap</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">hosts</span><span class="p">)))</span>
<span class="k">print</span> <span class="p">(</span><span class="s">'Alerts: '</span><span class="p">)</span>
<span class="n">pprint</span> <span class="p">(</span><span class="n">zap</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">alerts</span><span class="p">())</span>
</code></pre>

<p>The Spider is a tool that is used to automatically discover new resources (URLs) on a particular site. It begins with a 
list of URLs to visit, called the seeds, which depends on how the Spider is started. The Spider then visits these URLs, 
it identifies all the hyperlinks in the page and adds them to the list of URLs to visit, and the process continues 
recursively as long as new resources are found.</p>

<p>During the processing of a URL, the Spider makes a request to fetch the resource and then parses the response, identifying hyperlinks. 
Each response type is processed differently in ZAP. All the available endpoints for the spider can be found in <code class="prettyprint">spider</code></p>

<h3 id="start-the-spider">Start the spider</h3>

<p>The Spider(s) explore the site and don&rsquo;t actually do any scanning. The scan API will initiate the crawling of the Spiders.
The scan ID will be returned as the response after triggering the Spider.
The request whhich are proxied through the ZAP will be <a href="#passive_scan">passively scanned</a> by the passive scanner. The passive
scanner all of the requests and responses flowing through ZAP and report the issues they can spot. </p>

<h3 id="view-status">View Status</h3>

<p>The spider scan is a async request and the time to complete the task will vary depending on the complexity of the web application. 
The scan ID returned via starting the spider should be used to query the results. Execute the status API to get the status/ 
percentage of work done by the Spider.</p>

<h3 id="view-spider-results">View Spider Results</h3>

<p>The request in the code block will provide a response similar to the below, which will enlist all the resources the spider 
has crawled through.</p>

<p><img alt="spider results" src="../images/spider_results.png" /></p>

<h3 id="stop-or-pause-the-spider">Stop or Pause The Spider</h3>

<p>If the scanning takes too much time than expected you can stop or pause the scanning via using the start and pause APIs. 
Additional APIs are available in the API Catalogue to pause/resume/stop All the scanning processes.</p>

<h2 id="using-ajax-spider">Using AJAX Spider</h2>
<pre class="highlight shell"><code><span class="c"># To start the AJAX Spider</span>
<span class="gp">$ </span>curl <span class="s2">"http://localhost:8080/JSON/ajaxSpider/action/scan/?url=&lt;URL&gt;&amp;inScope=&amp;contextName=&amp;subtreeOnly="</span>


<span class="c"># To view the status</span>
<span class="gp">$ </span>curl <span class="s2">"http://localhost:8080/JSON/ajaxSpider/view/status/"</span>

<span class="c"># To view the number of results</span>
<span class="gp">$ </span>curl <span class="s2">"http://localhost:8080/JSON/ajaxSpider/view/numberOfResults/"</span>
<span class="c"># To view the results</span>
<span class="gp">$ </span>curl <span class="s2">"http://localhost:8080/JSON/ajaxSpider/view/fullResults/"</span>

<span class="c"># To stop the AJAX Spider</span>
<span class="gp">$ </span>curl <span class="s2">"http://localhost:8080/JSON/ajaxSpider/action/stop/"</span>
</code></pre>

<p>The AJAX Spider allows you to crawl web applications written in AJAX in far more depth than the native Spider. 
 Use the AJAX Spider if you may have web applications written in AJAX. You should also use the native Spider as well for 
 complete coverage of a web application (e.g. to cover HTML comments).</p>

<h3 id="start-ajax-spider">Start AJAX Spider</h3>

<p>Use the command in the right column to start the AJAX Spider. This will start a long running asynchronous task.</p>

<h3 id="view-status">View Status</h3>

<p>Unlike the traditional Spider, AJAX Spider does not provide a percentage for the work to be done. Use the <code class="prettyprint">status</code> endpoint to 
identify whether the Spider is still active or finished.</p>

<h3 id="view-results">View Results</h3>

<p>Use the following commands on the right to view the number of results or to obtain the entire results or a limited set of
results.</p>

<h3 id="stop-the-ajax-spider">Stop the AJAX Spider</h3>

<p>Ajax spider does not have an indication on how much resources are left to crawl. Therefor if the Ajax spider takes too much time
than expected, then it can be stopped by using the following command in the right.</p>

<p>View the <a href="#ajax_advanced">advanced settings</a> on how to enhance the Ajax Spider results.</p>

      </div>
      <div class="dark-box">
      </div>
    </div>
  </body>
</html>
